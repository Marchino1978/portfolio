<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SALVADANAIO</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f7f7f7;
        }

        h1 {
            color: red;
            font-size: 36px;
            margin-top: 20px;
            text-align: center;
        }

        #jar {
            position: relative;
            width: 180px;
            height: 400px;
            margin: 20px auto;
            background-color: transparent;
            border: 5px solid #000;
            border-radius: 20px;
            background: linear-gradient(to bottom, #d1d1d1 0%, #b3b3b3 100%);
            overflow: hidden;
        }

        #lid {
            position: absolute;
            top: -15px;
            left: 50%;
            width: 210px;
            height: 25px;
            margin-left: -105px;
            background-color: #7a7a7a;
            border-radius: 5px;
            box-shadow: 0px 3px 5px rgba(0,0,0,0.3);
        }

        .fill-level {
            position: absolute;
            bottom: 0;
            width: 100%;
            opacity: 0.7;
            transition: height 0.5s ease-in-out;
        }

        #value {
            font-size: 24px;
            margin-top: 20px;
        }

        #percentage {
            font-size: 20px;
            margin-top: 10px;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>SALVADANAIO</h1>

    <div id="jar">
        <div id="lid"></div>
        <div id="fill-level" class="fill-level"></div>
    </div>

    <div id="value">Valore: 0€</div>
    <div id="percentage">Riempimento: 0.0%</div>

    <script>
        async function loadValueFromCSV() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/Marchino1978/portfolio/refs/heads/main/data/salvadanaio.csv');
                if (!response.ok) {
                    throw new Error('Errore nel caricamento del file CSV');
                }

                const text = await response.text();

                const rows = text.split('\n');
                const value = parseFloat(rows[0].trim());

                if (isNaN(value)) {
                    throw new Error('Il valore nel CSV non è un numero valido');
                }

                return value;

            } catch (error) {
                console.error('Errore:', error.message);
                document.getElementById('value').textContent = 'Errore nel caricamento del valore.';
                document.getElementById('percentage').textContent = 'Riempimento: N/A';
                return NaN;
            }
        }

        function getColorBasedOnPercentage(percentage) {
            if (percentage <= 33) {
                return 'red'; // Colore rosso per 0% - 33%
            } else if (percentage <= 66) {
                return 'yellow'; // Colore giallo per 33.1% - 66%
            } else if (percentage < 100) {
                return 'green'; // Colore verde per 66.1% - 99%
            } else {
                return 'blue'; // Colore blu per 99.1% - 100%
            }
        }

        function updateFillLevel(valueInEuro) {
            const maxVolume = 4500; // Impostato il valore massimo di riempimento a 4500€

            if (valueInEuro < 0 || isNaN(valueInEuro)) {
                valueInEuro = 0;
            }

            const fillPercentage = Math.min((valueInEuro / maxVolume) * 100, 100);

            const fillColor = getColorBasedOnPercentage(fillPercentage);

            const fillLevelElement = document.getElementById('fill-level');
            fillLevelElement.style.height = fillPercentage + '%'; // Cambia l'altezza in base alla percentuale
            fillLevelElement.style.backgroundColor = fillColor; // Cambia il colore in base alla percentuale

            const percentageElement = document.getElementById('percentage');
            percentageElement.textContent = `Riempimento: ${fillPercentage.toFixed(1)}%`;
        }

        async function displayValue() {
            const value = await loadValueFromCSV();
            if (!isNaN(value)) {
                document.getElementById('value').textContent = `Valore: ${value.toFixed(0)}€`;
                updateFillLevel(value);
            } else {
                document.getElementById('value').textContent = 'Valore: N/A';
                document.getElementById('percentage').textContent = 'Riempimento: N/A';
            }
        }

        displayValue();
    </script>
</body>
</html>
